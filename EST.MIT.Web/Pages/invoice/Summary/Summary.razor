@page "/invoice/summary/{scheme}/{invoiceId}"
@page "/invoice/summary/{scheme}/{invoiceId}/{backUrl}"
@using EST.MIT.Web.Shared.Components.SummaryPaymentRequest
@using EST.MIT.Web.Shared.Components.InvoiceMetaData

<section class="govuk-width-container govuk-!-padding-top-3">
	<a href="@GetBackUrl()" class="govuk-back-link">Back</a>
	<h1 class="govuk-heading-l">Invoice Summary</h1>
</section>

<InvoiceMetaData Invoice=invoice/>

<section class="govuk-width-container govuk-!-padding-top-3">

	@if(invoice != null)
	{
		<button id="add-payment-request" class="govuk-button" data-prevent-double-click="true" data-module="govuk-button" @onclick="AddPaymentRequest">Add Payment Request</button>

		@if(!invoice.PaymentRequests.Any())
		{

			<div id="no-payment-request-warning" class="govuk-form-group--error">
				<h1 class="govuk-heading-l">This Invoice currently has no payment requests</h1>
				<div class="govuk-hint">You can select Add Payment Request to include one with this invoice.</div>
			</div>
		}
		else
		{
			@if(invoice.Status == "new")
			{
				<button id="send-approval" class="govuk-button govuk-!-margin-left-1" data-prevent-double-click="true" data-module="govuk-button" @onclick="SendForApproval">Send For Approval</button>
			}
			
			@foreach (var request in invoice.PaymentRequests)
			{
				<CascadingValue Value="this">
					<SummaryPaymentRequest PaymentRequest=request AccountType=@invoice.AccountType />
				</CascadingValue>
			}
		}
	}

</section>